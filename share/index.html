<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Browser</title>
    <!-- Font Awesome for file icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Basic styles for the body and fonts */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: #f9f9f9;
            color: #333;
        }

        /* Header styles */
        header {
            background-color: #fff;
            padding: 15px 30px;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        header h1 {
            margin: 0;
            font-size: 1.5em;
            color: #444;
        }
        
        #breadcrumb {
            font-size: 1.2em;
            color: #555;
        }

        #breadcrumb a {
            color: #0366d6;
            text-decoration: none;
        }

        #breadcrumb a:hover {
            text-decoration: underline;
        }

        /* Main container for the file browser */
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Loading spinner styles */
        #loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Grid layout for files and folders */
        #file-browser {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        /* Styles for each file/folder item */
        .file-item {
            background-color: #fff;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: box-shadow 0.2s, transform 0.2s;
            word-wrap: break-word;
        }

        .file-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-3px);
        }

        /* Icon and thumbnail container */
        .file-item .icon {
            font-size: 4em; /* Default icon size */
            margin-bottom: 15px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .file-item .icon img {
            max-width: 100%;
            max-height: 80px;
            border-radius: 4px;
            object-fit: cover;
        }

        /* File name styles */
        .file-item .file-name {
            font-size: 0.9em;
            font-weight: 500;
        }
        
        /* Responsive design for smaller screens */
        @media (max-width: 600px) {
            #file-browser {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 15px;
            }
            .file-item .icon {
                font-size: 3em;
                height: 60px;
            }
            header {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>File Browser</h1>
        <div id="breadcrumb"></div>
    </header>

    <div class="container">
        <div id="loading">
            <div class="spinner"></div>
            <p>Fetching files...</p>
        </div>
        <div id="file-browser"></div>
    </div>

    <script>
        // ===================================================================================
        // CONFIGURATION: Update these variables with your GitHub username and repository name
        // ===================================================================================
        const username = 'francispun'; // <--- CHANGE THIS
        const repoName = 'francispun-website'; // <--- CHANGE THIS
        const initialPath = 'share'; // <--- Set the subfolder you want to browse as the root
        // ===================================================================================

        const fileBrowser = document.getElementById('file-browser');
        const loadingIndicator = document.getElementById('loading');
        const breadcrumbNav = document.getElementById('breadcrumb');

        // Variable to keep track of the current full path within the GitHub repository
        let currentRepoPath = initialPath;

        /**
         * Fetches and displays the content of a directory from the GitHub repository.
         * This function now also updates the browser's URL hash.
         * @param {string} repoPath - The full path to the directory within the GitHub repository (e.g., 'share', 'share/documents').
         */
        async function loadDirectory(repoPath) {
            showLoading(true);
            fileBrowser.innerHTML = '';
            currentRepoPath = repoPath; // Update the global currentRepoPath
            updateBreadcrumb(currentRepoPath);

            // Update URL hash to reflect the current display path
            // The hash should be relative to the initialPath
            let hashPath = '';
            if (repoPath.startsWith(initialPath) && repoPath.length > initialPath.length) {
                hashPath = repoPath.substring(initialPath.length + 1); // +1 to remove the leading '/'
            }
            window.location.hash = hashPath ? `/${hashPath}` : ''; // Ensure leading slash for consistency, or empty for root

            const apiUrl = `https://api.github.com/repos/${username}/${repoName}/contents/${repoPath}`;

            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();

                // Sort items to show folders first, then files alphabetically
                data.sort((a, b) => {
                    if (a.type === b.type) {
                        return a.name.localeCompare(b.name);
                    }
                    return a.type === 'dir' ? -1 : 1;
                });

                data.forEach(item => {
                    createFileItem(item);
                });

            } catch (error) {
                fileBrowser.innerHTML = `<p>Error loading files: ${error.message}. Make sure the repository is public and the details are correct.</p>`;
            } finally {
                showLoading(false);
            }
        }

        /**
         * Creates and appends a file or folder item to the browser view.
         * @param {object} item - The file or folder object from the GitHub API.
         */
        function createFileItem(item) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            
            const iconDiv = document.createElement('div');
            iconDiv.className = 'icon';
            
            // Determine the icon or thumbnail
            if (item.type === 'dir') {
                iconDiv.innerHTML = '<i class="fas fa-folder" style="color: #5894df;"></i>';
                // When a folder is clicked, call loadDirectory with its full path
                fileItem.onclick = () => loadDirectory(item.path); 
            } else {
                const extension = item.name.split('.').pop().toLowerCase();
                if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension)) {
                    // Display a thumbnail for images
                    iconDiv.innerHTML = `<img src="${item.download_url}" alt="${item.name}">`;
                } else {
                    // Display an icon for other file types
                    iconDiv.innerHTML = getFileIcon(extension);
                }
                // Open the raw file in a new tab when clicked
                fileItem.onclick = () => window.open(item.download_url, '_blank'); 
            }

            const fileName = document.createElement('div');
            fileName.className = 'file-name';
            fileName.textContent = item.name;

            fileItem.appendChild(iconDiv);
            fileItem.appendChild(fileName);
            fileBrowser.appendChild(fileItem);
        }

        /**
         * Returns an HTML string for a Font Awesome icon based on file extension.
         * @param {string} extension - The file extension.
         * @returns {string} The HTML for the icon.
         */
        function getFileIcon(extension) {
            switch (extension) {
                case 'pdf':
                    return '<i class="fas fa-file-pdf" style="color: #d9534f;"></i>';
                case 'doc':
                case 'docx':
                    return '<i class="fas fa-file-word" style="color: #2b579a;"></i>';
                case 'xls':
                case 'xlsx':
                    return '<i class="fas fa-file-excel" style="color: #217346;"></i>';
                case 'ppt':
                case 'pptx':
                    return '<i class="fas fa-file-powerpoint" style="color: #d24726;"></i>';
                case 'zip':
                case 'rar':
                    return '<i class="fas fa-file-archive" style="color: #f0ad4e;"></i>';
                case 'txt':
                    return '<i class="fas fa-file-alt" style="color: #5bc0de;"></i>';
                case 'html':
                case 'js':
                case 'css':
                case 'json':
                    return '<i class="fas fa-file-code" style="color: #5cb85c;"></i>';
                default:
                    return '<i class="fas fa-file" style="color: #666;"></i>';
            }
        }
        
        /**
         * Updates the breadcrumb navigation.
         * @param {string} repoPath - The current full path within the repository.
         */
        function updateBreadcrumb(repoPath) {
            breadcrumbNav.innerHTML = '';
            
            const rootLink = document.createElement('a');
            rootLink.href = '#'; // Link to the root of the file browser (which is initialPath)
            rootLink.textContent = 'Root'; 
            rootLink.onclick = (e) => {
                e.preventDefault();
                loadDirectory(initialPath); 
            };
            breadcrumbNav.appendChild(rootLink);

            // Only add subsequent breadcrumbs if we are deeper than the initialPath
            if (repoPath.startsWith(initialPath) && repoPath.length > initialPath.length) {
                let relativePath = repoPath.substring(initialPath.length);
                // Remove leading slash if present (e.g., from "/subfolder")
                if (relativePath.startsWith('/')) {
                    relativePath = relativePath.substring(1);
                }
                
                const parts = relativePath.split('/').filter(p => p !== '');
                let currentAccumulatedRepoPath = initialPath; // Full path for loadDirectory calls

                parts.forEach((part, index) => {
                    currentAccumulatedRepoPath += '/' + part;

                    const separator = document.createElement('span');
                    separator.textContent = ' / ';
                    breadcrumbNav.appendChild(separator);

                    if (index < parts.length - 1) { // Not the last part
                        const partLink = document.createElement('a');
                        partLink.href = '#';
                        partLink.textContent = part;
                        const pathToLoad = currentAccumulatedRepoPath; 
                        partLink.onclick = (e) => {
                            e.preventDefault();
                            loadDirectory(pathToLoad);
                        };
                        breadcrumbNav.appendChild(partLink);
                    } else { // The current folder
                        const currentFolder = document.createElement('span');
                        currentFolder.textContent = part;
                        breadcrumbNav.appendChild(currentFolder);
                    }
                });
            }
        }

        /**
         * Toggles the visibility of the loading indicator.
         * @param {boolean} isLoading - Whether to show the loading indicator.
         */
        function showLoading(isLoading) {
            loadingIndicator.style.display = isLoading ? 'block' : 'none';
        }

        /**
         * Handles changes to the URL hash, loading the corresponding directory.
         */
        function handleHashChange() {
            let hashPath = window.location.hash.substring(1); // Remove the '#'
            if (hashPath.startsWith('/')) {
                hashPath = hashPath.substring(1); // Remove leading '/' if present
            }

            let pathFromHash = initialPath;
            if (hashPath) {
                pathFromHash += '/' + hashPath;
            }
            
            // Only load if the path derived from hash is different from currentRepoPath
            // This prevents unnecessary reloads when loadDirectory itself changes the hash
            if (pathFromHash !== currentRepoPath) {
                loadDirectory(pathFromHash);
            }
        }

        // Initial load: Check hash or load initialPath
        document.addEventListener('DOMContentLoaded', () => {
            if (window.location.hash) {
                handleHashChange(); // Load content based on existing hash
            } else {
                loadDirectory(initialPath); // Load the default initial path
            }
        });

        // Listen for hash changes (e.g., browser back/forward buttons)
        window.addEventListener('hashchange', handleHashChange);
    </script>

</body>
</html>
